<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Declaration · Cropbox.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-192782823-1"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-192782823-1', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://cropbox.github.io/Cropbox.jl/stable/reference/declaration/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Cropbox.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Cropbox.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Guide</span></li><li><span class="tocitem">Tutorials</span></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../">Index</a></li><li class="is-active"><a class="tocitem" href>Declaration</a></li><li><a class="tocitem" href="../simulation/">Simulation</a></li><li><a class="tocitem" href="../visualization/">Visualization</a></li><li><a class="tocitem" href="../inspection/">Inspection</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li class="is-active"><a href>Declaration</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Declaration</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/cropbox/Cropbox.jl/blob/master/docs/src/reference/declaration.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Declaration"><a class="docs-heading-anchor" href="#Declaration">Declaration</a><a id="Declaration-1"></a><a class="docs-heading-anchor-permalink" href="#Declaration" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="Cropbox.@system" href="#Cropbox.@system"><code>Cropbox.@system</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@system name[{patches..}][(mixins..)] [&lt;: type] [decl] -&gt; Type{&lt;:System}</code></pre><p>Declare a new system called <code>name</code> with new variables declared in <code>decl</code> block using a custom syntax. The resultant system is subtype of <code>System</code> or a custom <code>type</code>. <code>mixins</code> allows reusing specification of existing systems to be pasted into the declaration of new system. <code>patches</code> may provide type substitution and/or constant definition needed for advanced use.</p><p><strong>Variable</strong></p><pre><code class="nohighlight hljs">name[(args..; kwargs..)][: alias] [=&gt; expr] [~ [state][::type|&lt;:type][(tags..)]]</code></pre><ul><li><code>name</code>: variable name; usually short abbreviation.</li><li><code>args</code>: automatically bound depending variables</li><li><code>kwargs</code>: custom bound depending variables; used by <code>call</code> and <code>integrate</code>.</li><li><code>alias</code>: alternative name; long description.</li><li><code>expr</code>: state-specific code snippet; use begin-end block for multiple statements.</li><li><code>type</code>: internal data type; default is Float64 for many, but not all, variables.</li><li><code>tags</code>: state-specific options; <code>unit</code>, <code>min</code>/<code>max</code>, etc.</li></ul><p><strong>States</strong></p><ul><li><code>hold</code>: marks a placeholder for variable shared between mixins.</li><li><code>wrap</code>: passes a state variable to other fucnction as is with no unwrapping its value.</li><li><code>advance</code>: manages a time-keeping variable; <code>time</code> and <code>tick</code> from <code>Clock</code>.</li><li><code>preserve</code>: keeps initially assigned value with no further updates; constants, parameters.</li><li><code>tabulate</code>: makes a two dimensional table with named keys; <em>i.e.</em> partitioning table.</li><li><code>interpolate</code>: makes a curve fuction interpolated with discrete values; <em>i.e.</em> soil characteristic curve.</li><li><code>track</code>: evaluates variable expression as is for each update.</li><li><code>remember</code>: keeps tracking variable until a certain condition is met; essentially <code>track</code> turning into <code>preserve</code>.</li><li><code>provide</code>: manages a table of time-series in DataFrame.</li><li><code>drive</code>: fetchs the current value from a time-series; maybe supplied by <code>provide</code>.</li><li><code>call</code>: defines a partial function bound with some variables.</li><li><code>integrate</code>: calculates integral using Gaussian method; not for time domain.</li><li><code>accumulate</code>: emulates integration of rate variable over time; essentially Euler method.</li><li><code>capture</code>: calculates difference between integration for each time step.</li><li><code>flag</code>: sets a boolean flag; essentially <code>track::Bool</code>.</li><li><code>produce</code>: attaches a new instance of system dynamically constructed; <em>i.e.</em> root structure growth.</li><li><code>bisect</code>: solves nonlinear equation using bisection method; <em>i.e.</em> gas-exchange model coupling.</li><li><code>solve</code>: solves polynomical equation symbolically; <em>i.e.</em> quadratic equations in photosynthesis model.</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; @system S(Controller) begin
           a =&gt; 1 ~ preserve(parameter)
           b(a) ~ accumulate
       end
S</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cropbox/Cropbox.jl/blob/6cd644a65ce14f6e3a5900d22256e5b24c216622/src/macro.jl#L629-L673">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Cropbox.@config" href="#Cropbox.@config"><code>Cropbox.@config</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@config c.. -&gt; Config | Vector{Config}</code></pre><p>Construct a set or multiple sets of configuration.</p><p>A basic unit of configuration for a system <code>S</code> is represented by a pair in the form of <code>S =&gt; pv</code>. System name <code>S</code> is expressed in a symbol. If actual type of system is used, its name will be automatically converted to a symbol.</p><p>A parameter name and corresponding value is then represented by another pair in the form of <code>p =&gt; v</code>. When specifiying multiple parameters, a tuple of pairs like <code>(p1 =&gt; v1, p2 =&gt; v2)</code> or a named tuple like <code>(p1 = v1, p2 = v2)</code> can be used. Parameter name must be a symbol and should indicate a variable declared with <code>parameter</code> tag as often used by <code>preserve</code> state variable. For example, <code>:S =&gt; (:a =&gt; 1, :b =&gt; 2)</code> has the same meaning as <code>S =&gt; (a = 1, b = 2)</code> in the same scope.</p><p>Configurations for multiple systems can be concatenated by a tuple. Multiple elements in <code>c</code> separated by commas implicitly forms a tuple. For example, <code>:S =&gt; (:a =&gt; 1, :b =&gt; 2), :T =&gt; :x =&gt; 1</code> represents a set of configuration for two systems <code>S</code> and <code>T</code> with some parameters. When the same names of system or variable appears again during concatenation, it will be overriden by later ones in an order appeared in a tuple. For example, <code>:S =&gt; :a =&gt; 1, :S =&gt; :a =&gt; 2</code> results into <code>:S =&gt; :a =&gt; 2</code>. Instead of commas, <code>+</code> operator can be used in a similar way as <code>(:S =&gt; :a =&gt; 1) + (:S =&gt; :a =&gt; 2)</code>. Note parentheses placed due to operator precedence.</p><p>When multiple sets of configurations are needed, as in <code>configs</code> for <a href="../simulation/#Cropbox.simulate"><code>simulate</code></a>, a vector of <code>Config</code> is used. This macro supports some convenient ways to construct a vector by composing simpler configurations. Prefix operator <code>!</code> allows <em>expansion</em> of any iterable placed in the configuration value. Infix operator <code>*</code> allows <em>multiplication</em> of a vector of configurations with another vector or a single configuration to construct multiple sets of configurations. For example, <code>!(:S =&gt; :a =&gt; 1:2)</code> is expanded into two sets of separate configurations <code>[:S =&gt; :a =&gt; 1, :S =&gt; :a =&gt; 2]</code>. <code>(:S =&gt; :a =&gt; 1:2) * (:S =&gt; :b =&gt; 0)</code> is multiplied into <code>[:S =&gt; (a = 1, b = 0), :S =&gt; (a = 2, b = 0)]</code>.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; @config :S =&gt; (:a =&gt; 1, :b =&gt; 2)
Config for 1 system:
  S
    a = 1
    b = 2</code></pre><pre><code class="language-julia-repl hljs">julia&gt; @config :S =&gt; :a =&gt; 1, :S =&gt; :a =&gt; 2
Config for 1 system:
  S
    a = 2</code></pre><pre><code class="language-julia-repl hljs">julia&gt; @config !(:S =&gt; :a =&gt; 1:2)
2-element Vector{Config}:
 &lt;Config&gt;
 &lt;Config&gt;</code></pre><pre><code class="language-julia-repl hljs">julia&gt; @config (:S =&gt; :a =&gt; 1:2) * (:S =&gt; :b =&gt; 0)
2-element Vector{Config}:
 &lt;Config&gt;
 &lt;Config&gt;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cropbox/Cropbox.jl/blob/6cd644a65ce14f6e3a5900d22256e5b24c216622/src/config.jl#L255-L297">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Index</a><a class="docs-footer-nextpage" href="../simulation/">Simulation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.7 on <span class="colophon-date" title="Friday 8 October 2021 04:58">Friday 8 October 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
